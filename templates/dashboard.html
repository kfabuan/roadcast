{% extends 'nav_admin.html' %}
{% block title %} Dashboard {% endblock %}

{% block design %}

<style>
    .vl {
      border-left: 6px solid green;
      height: 500px;
    }

    .count-title{
        color:red;
    }

    .card {
            box-shadow: 0 0.5rem 1rem 0 rgba(167, 167, 167, 0.164);
            border-radius: 15px !important;
        }
    .card-body {
        border-radius: 15px !important;
    }
</style>

{% endblock %}

<script>
    {% block jquery %}

        var endpoint = '/dashboard/data'

        var district1_labels = []
        var district1_count = []

        var district2_labels = []
        var district2_count = []

        var offense_labels = []
        var offense_count = []

        var sex_labels = []
        var sex_count = []

        var time_count = []

        $.ajax({
             method: "GET",
             url: endpoint,
             success: function(data){

                district1_labels = data.district1_labels
                district1_count = data.district1_count

                district2_labels = data.district2_labels
                district2_count = data.district2_count

                offense_labels = data.offense_labels
                offense_count = data.offense_count

                sex_labels = data.sex_labels
                sex_count = data.sex_count

                time_count = data.time_count
             
                setChart()
    
            },

             error: function(error_data){
                 console.log("Error")
                 console.log(error_data)
             }
        })

        function setChart(){
            var line_date_forecast = document.getElementById('line_date_forecast'); //weekly forecasting
            var line_time = document.getElementById('line_time'); //time
            var ctx = document.getElementById('myChart'); //district
            var ctx2 = document.getElementById('myChart2'); //district1
            var ctx3 = document.getElementById('myChart3'); //district2
            var pie_sex = document.getElementById('pie_sex'); //sex
            var bar_offense = document.getElementById('bar_offense'); //offenses

            var line_date_forecast = new Chart(line_date_forecast, {
                type: 'line',
                data: {
                    labels: [ 

                    {%for i in datelist%}
                    '{{i.Date}}',
                    {%endfor%}

                    ],
                    datasets: [
                        {
                            label: 'No. of incidents',
                            data: [
                                    {%for j in reversed_datelist_values%}
                                    {{j.Incidents}},
                                    {%endfor%}
                                    ],
                            fill: false,
                            borderColor: 'rgb(65,105,225)',
                            tension: 0.1
                        },
                        {
                            label: 'Forecasted',
                            data: [,,,,,,,{%for k in reversed_datelist_values_forecast%}
                                    {{k.Averages}},
                                    {%endfor%}],
                            fill: false,
                            borderColor: 'rgb(255,140,0)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Weekly Forecasting'
                        }
                    }
                }
            });

            var line_time = new Chart(line_time, {
                type: 'line',
                data: {
                    labels: ["0:00:00", "2:00:00", "4:00:00", "6:00:00","8:00:00", "10:00:00", "12:00:00","14:00:00","16:00:00","18:00:00","20:00:00","22:00:00",],
                    datasets: [{
                        label: 'Yearly Hazardous Time',
                        data: time_count,
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    plugins: {
                        legend:{
                            
                        },
                        title: {
                            display: true,
                            text: 'Accident Prone Time'
                        }
                    }
                }
            });

            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['District 1', 'District 2'],
                    datasets: [{
                        label: 'District 1',
                        //data: [12, 19, 3, 5, 12, 3],
                        data: [1,2],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1,
                        //fill: true, if line ang type
                    }]
                },
                options: {
                    scales: {
                        y: {beginAtZero: true}
                    }
                }
            });

            var myChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: district1_labels,
                    datasets: [{
                        label: 'District 1',
                        data: district1_count,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1,
                        //fill: true, if line ang type
                    }]
                },
        
                options: {
                    scaleShowValues: true,
                    indexAxis: 'x',
                    scales: {
                        xAxes: [{ stacked: true }],
                        yAxes: [{ stacked: true }]
                    },
                    animation: {
                        duration: 1000,
                        easing: 'linear'
                    }
                }
            });

            var myChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: district2_labels,
                    datasets: [{
                        label: 'District 2',
                        data: district2_count,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1,
                        //fill: true, if line ang type
                    }]
                },
                options: {
                    scales: {
                        y: {beginAtZero: true}
                    },

                    animation: {
                        duration: 1000,
                        easing: 'linear'
                    }
                }
            });

            var pie_sex = new Chart(pie_sex, {
                type: 'doughnut',
                data: {
                    labels: sex_labels,
                    datasets: [{
                        label: 'Sex',
                        data: sex_count,
                        backgroundColor: [
                        'rgb(54, 162, 235)',
                        'rgb(255, 99, 132)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        ],
                        hoverOffset: 4
                    }]
                }, 
                options: {
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Yearly Sex Distribution'
                        }
                    }
                }
                
            });

            var bar_offense = new Chart(bar_offense, {
                type: 'bar',
                data: {
                    labels: offense_labels,
                    datasets: [{
                        label: 'Yearly Crime/Offense',
                        data: offense_count,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1,
                        //fill: true, if line ang type
                    }]
                },
                options: {
                    scales: {
                        y: {beginAtZero: true}
                    }
                }
            });


        } //close function

    {% endblock %}
</script>

{% block content %}

    <!-- {% for a in all %}
        {% ifequal a.id request.session.authorized_id %}
        <p>{{a.Members_Fname}}</p>
        <p>{{a.Members_Lname}}</p>

        {% endifequal %}

    {% endfor %}

    {% for b in pub %}
        {% ifequal b.id request.session.public_id %}
        <p>{{b.gen_surname}}</p>
        <p>{{b.gen_fname}}</p>

        {% endifequal %}

    {% endfor %} -->



    <b id="date-today">Today: </b><span id="ct6"></span> 


    <div class="row" style="border:0; margin:0; padding:0;">
        <!-- first half -->
        <div class="col-sm-6">
          <div class="">
            <div class="card-body mb-4" style="background-color: white;">
                <h5 class="card-title">Road Accident Cases</h5>

                <div class="row">
                    <div class="col-sm-4">
                      <div class="card">
                        <div class="card-body text-center">
                          <h6 style="color: #a6a6a6;"> Week: {{week_num }}</h6>
                          <h3>{{ this_week }}</h3>
                        </div>
                      </div>
                    </div>

                    <div class="col-sm-4">
                      <div class="card">
                        <div class="card-body text-center">
                          <h6 style="color: #a6a6a6;">Yesterday</h6>
                          <h3>{{ yesterday_total }}</h3>
                        </div>
                      </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="card">
                          <div class="card-body text-center">
                            <h6 style="color: #a6a6a6;">Today</h6>
                            <h3>{{ this_day }}</h3>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

                <!-- <div class="card" style="height: 540px;">
                <div id="map"></div>
                </div>
          </div>
        </div> -->

        <div class="card mb-4">
            <div class="ratio ratio-4x3">
                <div id="map"  style="border-radius: 15px;"></div>
            </div>
        </div>
      </div>
    </div>

        <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyACS7G3CoYRTEAOy4vAUdPq1H08ueUoDXI&callback=initMap"></script> 

        <script type="text/javascript">

            var locations = [
        
            {% for i in markers_json %}
        
            ['{{i.Address}}',{{i.Latitude}},{{i.Longitude}}],
        
            {% endfor %}
        
            ]
            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 13,
              center: new google.maps.LatLng(14.580466330345176, 121.09153585874454),
              mapTypeId: google.maps.MapTypeId.ROADMAP
            });
        
            var infowindow = new google.maps.InfoWindow();
        
            var marker, i;
        
            for (i = 0; i < locations.length; i++) {
              marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                map: map
              });
        
              google.maps.event.addListener(marker, 'click', (function(marker, i) {
                return function() {
                  infowindow.setContent(locations[i][0]);
                  infowindow.open(map, marker);
                }
              })(marker, i));
            }
          </script>
        



        <!-- second half -->
        <div class="col-sm-6">
                <div class="card mb-4">
                    <div class="card-body" style="background-color: white;">
                        <div class="">
                            <canvas id="line_date_forecast" height=""></canvas>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body" style="background-color: white;">
                        <div class="">
                            <canvas id="line_time" height=""></canvas>
                        </div>
                    </div>
                </div>
          </div>
    </div>

      <div class="row" style="border:0; margin:0; padding:0;">
        <div class="col-sm-6 mb-4">
            <div class="card">
                <div class="card-body" style="background-color: white;">
                    <div class="">
                        <canvas id="myChart2" height="135"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 mb-4">
            <div class="card">
                <div class="card-body" style="background-color: white;">
                    <div class="">
                        <canvas id="myChart3" height="135"></canvas>
                    </div>
                </div>
            </div>
        </div>
      </div>

    
      <div class="row" style="border:0; margin:0; padding:0;">
        <div class="col-sm-4 mb-4">
            <div class="card">
                <div class="card-body" style="background-color: white;">
                    <div class="">
                        <canvas id="pie_sex" height="135"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-8 mb-4">
            <div class="card">
                <div class="card-body" style="background-color: white;">
                    <div class="">
                        <canvas id="bar_offense" height="135"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
{% endblock content %}

